<%
case params[:action]
when 'new'
  submit_label = 'Create'
  id = @object.nil? ? params[:id] : @object.id.to_s
  action = "/#{params[:controller]}/#{params[:action]}/#{id}"
  method = :post
when 'edit'
  submit_label = 'Update'
  action = "/#{params[:controller]}/#{params[:action]}/#{@object.id.to_s}"
  method = :post
when 'destroy'
  submit_label = 'Destroy'
  if @object && @object.id
    action = @object.id.to_s
  elsif params[:id]
    action = params[:id]
  end
  method = :delete
when 'restore'
  submit_label = 'Restore'
  if @object && @object.id
    action = @object.id.to_s
  elsif params[:id]
    action = params[:id]
  end
when 'purge'
  submit_label = 'Destroy'
  action = "/#{params[:controller]}/#{params[:action]}/#{@object.id.to_s}"
  method = :delete
else
  submit_label = params[:action].capitalize
  action = "/#{params[:controller]}/#{params[:action]}/#{@object.id.to_s}"
  method = params[:method]
end
%>

<h1>Please provide comments</h1>
<% if @change_log.errors.size > 0 %>
<div class="errorExplanation" id="errorExplanation"><h2><%= @change_log.errors.size %> error<%= 's' unless @change_log.errors.size == 1 %> prohibited this action from completing</h2><p>There were problems with the following fields:</p><ul><%
@change_log.errors.each do |error|
  %><li><%= error[0].capitalize %> <%= error[1] %></li><%
end
%></ul></div>
<% end -%>

<% form_tag action, :method => method do %>
  <fieldset>
    <legend><%= params[:action].capitalize %> <%= params[:controller].singularize %></legend>
    
    <fieldset>
      <legend<%= ' class="required"' unless params[:action].eql?('new') || params[:action].eql?('create') %>>Comments</legend>
      <p class="small">Please enter comments for the change log.</p>
      <p><%= text_area :change_log, :comments, {:class => 'small', :rows => 3} %></p>
    </fieldset>
    
    <div>
      <%= submit_tag(submit_label) %>
    </div>
  </fieldset>
<% end -%>
